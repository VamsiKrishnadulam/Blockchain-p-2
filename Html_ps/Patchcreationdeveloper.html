<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js"
		integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous"></script>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
	<script src="bothdevcommon.js"></script>
</head>

<body onload="connectMetamask()">

	<nav class="navbar navbar-expand-lg bg-dark">
		<div class="container-fluid">
			<div class="navbar-brand text-white" href="#">PMS</div>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
				aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="d-flex justify-content-end">
				<div class="collapse navbar-collapse" id="navbarNavDropdown">
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('EndUserReportBugs.html')">End User</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('labeller.html')">Labeller</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('Adminfromlabeller.html')">Admin</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark"
							onclick="window.open('Patchcreationdeveloper.html')">Developer</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('verifier.html')">Verifier</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('Aboutus.html')">ABOUT US</button>
					</div>
					<!-- <div class="nav-item">
						  <button class="btn btn-dark" onclick="window.open('Register.html')">Register</button>
						</div> -->
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('page1.html')">
							LOG-IN
						</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('contact.html')">
							CONTACT US
						</button>
					</div>
				</div>
			</div>
		</div>
		</div>
	</nav>
	<div id="TransactionSuccessfull">

	</div>

	<br><br><br><br>
	<div class="container">
		<div class="card text-center">
			<div class="card-header ">
				<ul class="nav nav-pills card-header-pills d-flex justify-content-evenly">
					<li class="nav-item mx-2 col-sm">
						<button class="btn btn-dark" onclick="window.open('Developergetsrequest.html')">Gets Request
							from Admin
						</button>
					</li>
					<li class="nav-item mx-2 col-sm">
						<button class="btn btn-dark" onclick="window.open('Patchcreationdeveloper.html')">Register a
							Patch
						</button>
					</li>
					<li class="nav-item mx-2 col-sm">
						<button class="btn btn-dark" onclick="window.open('Developergetsrejectedpatches.html')">Rejected 

							Patches</button>
					</li>

				</ul>
			</div>
			<div class="card-body">
				<form action="">
					<div class="container  ">
						
						<div class="row">
							<div class="col-12 col-lg-6 mx-auto">
								<div class="input-group mb-3 me-3 d-flex align-items-end">
									<label for="patchname">
										<h5> Request No : &nbsp </h5>
									</label>
									<input type="number" id="RequestNo" class="form-control" placeholder="Request No" readonly>
									<label class="input-group-text" for="RequestNo">Request No</label>
								</div>
							</div>
						</div>

						<div class="row">

							<div class="col-12 col-lg-6 mx-auto">
								<div class="input-group mb-3 me-3 d-flex align-items-end">
									<label for="patchname">
										<h5> Upload : &nbsp </h5>
									</label>
									<input type="file" class="form-control" id="inputGroupFile">
									<label class="input-group-text" for="inputGroupFile">Upload</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-12 col-lg-6 mx-auto">
								<div class="input-group mb-3 me-3 d-flex align-items-end">
									<label for="patchname">
										<h5> Patch Name : &nbsp </h5>
									</label>
									<input type="text" id="patchname" class="form-control" placeholder="Patch name">
									<label class="input-group-text" for="patchname">Patchname</label>
								</div>
							</div>
						</div>
						
						<div class="row">
							<div class="col-12 col-lg-6 mx-auto">
								<div class="input-group mb-3 me-3 d-flex align-items-center">
									<label for="patchplatform">
										<h5> Software or platform : &nbsp </h5>
									</label>
									<input type="text" class="form-control" id="patchplatform" placeholder="Software" readonly>
									
								</div>
							</div>
						</div>
						
						<div class="row">
							<div class="col-12 col-lg-6 mx-auto ">
								<div class="input-group mb-3 me-3 d-flex align-items-end">
									<label for="patchno">
										<h5> Patch No : &nbsp </h5>
									</label>
									<input class="form-control" type="number" id="patchno" value="0" readonly>
									<label class="input-group-text" for="patchno">Patch No</label>
								</div>
							</div>
						</div>
						<br>
						<div class="row">
							<div class="col-12 col-lg-6 mx-auto">
								<div class="input-group mb-3 me-3 d-flex align-items-center">
									<label for="Features">
										<h5> Patch Features : &nbsp </h5>
									</label>
									<textarea type='text' class="form-control" id="Features" name="Features" rows="5"
										cols="100" placeholder="Features"></textarea>
									
								</div>
							</div>
						</div>
						<div>
							<button class="btn btn-dark" type="button" onclick="registerpatchdetails()">Submit</button>
						</div>
				</form>
			</div>
		</div>
	</div>
	<script src="verifierjs.js"></script>
	<script>
		let account;
		const connectMetamask = async () => {
			if (window.ethereum !== "undefined") {
				const accounts = await ethereum.request({ method: "eth_requestAccounts" });
				account = accounts[0];
			}
			const ABI2 = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_patchname",
				"type": "string"
			}
		],
		"name": "Deployed",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "PatchArray",
		"outputs": [
			{
				"internalType": "string",
				"name": "patchname",
				"type": "string"
			},
			{
				"internalType": "bytes",
				"name": "fileData",
				"type": "bytes"
			},
			{
				"internalType": "string",
				"name": "patchplatform",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "patchfeatures",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "time",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "verificationstatus",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "deploymentstatus",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "patchno",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "requestnumber",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "deployedTimeStamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "check",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "developer",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_patchname",
				"type": "string"
			}
		],
		"name": "findandreply",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_patchname",
				"type": "string"
			}
		],
		"name": "findandreplynotverified",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getdetails",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "patchname",
						"type": "string"
					},
					{
						"internalType": "bytes",
						"name": "fileData",
						"type": "bytes"
					},
					{
						"internalType": "string",
						"name": "patchplatform",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "patchfeatures",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "time",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "verificationstatus",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "deploymentstatus",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "patchno",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "requestnumber",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "deployedTimeStamp",
						"type": "uint256"
					}
				],
				"internalType": "struct RegisterPatch.Patch[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getdetailsRequest",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string[]",
						"name": "bugs",
						"type": "string[]"
					},
					{
						"internalType": "string[]",
						"name": "features",
						"type": "string[]"
					},
					{
						"internalType": "string",
						"name": "date",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "requestno",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "software",
						"type": "string"
					}
				],
				"internalType": "struct RegisterPatch.request[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "labeller",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "map",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "map2",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "patches",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "requestArray",
		"outputs": [
			{
				"internalType": "string",
				"name": "date",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "requestno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "software",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "result",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "_filedata",
				"type": "bytes"
			},
			{
				"internalType": "string",
				"name": "_patchname",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_patchplatform",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_patchfeatures",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_patchno",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_requestnumber",
				"type": "uint256"
			}
		],
		"name": "setPatch",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string[]",
				"name": "_bugs",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "_features",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "_date",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_requestno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_software",
				"type": "string"
			}
		],
		"name": "setRequest",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "verifier",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
				const Address2 = "0x58d9825e8Cb33e78989FD76663A5774fB280bF4c";
			window.web3 = await new Web3(window.ethereum);
			window.contract = await new window.web3.eth.Contract(ABI2, Address2);
			
			var myFlag = localStorage.getItem('myFlag');
			if(myFlag=="GeneralPage"){
			var ObjStr = localStorage.getItem("myObj");
			var Obj = JSON.parse(ObjStr);
			console.log(Obj.software);
			document.getElementById('Features').innerHTML='Bugs Solved:';
			for(let i=0;i<Obj.arrbugs.length;i++){
				if(i==0){
					document.getElementById('Features').innerHTML+=Obj.arrbugs[i];
				}
				else{
			document.getElementById('Features').innerHTML+= ","+Obj.arrbugs[i];
				}
			}
			document.getElementById('Features').innerHTML+="\n"+'Featrues Solved:';
			for(let j=0;j<Obj.arrfeatures.length;j++){
				if(Obj.arrbugslength==0){
					document.getElementById('Features').innerHTML+=Obj.arrfeatures[j];
				}
				else{
			document.getElementById('Features').innerHTML+= ","+Obj.arrfeatures[j];
				}
			}
			document.getElementById('RequestNo').value=Obj.requestnumber;
			document.getElementById('patchplatform').value=Obj.software;
		}
		else if(myFlag=="RejectedPage"){
			var ObjStr = localStorage.getItem("myObj2");
			var Obj = JSON.parse(ObjStr);
			console.log(Obj)
			console.log(Obj.software);
			document.getElementById('Features').innerHTML=Obj.features;
			
			document.getElementById('RequestNo').value=Obj.requestnumber;
			document.getElementById('patchplatform').value=Obj.software;
		}



			await window.contract.methods.getdetails().call().then((result) => {
				console.log(result);
				document.getElementById("patchno").value = result.length + 1;
			});
 
		}
		async function registerpatchdetails() {

			let fileinput = document.getElementById("inputGroupFile");
			const file = fileinput.files[0];
			const reader = new FileReader();
			reader.readAsArrayBuffer(file);
			reader.onload = async ()=>{
				const fileData = new Uint8Array(reader.result);
				let account = (await web3.eth.getAccounts())[0];
				console.log(fileData);
				const patchname = document.getElementById("patchname").value;
				const RequestNo = document.getElementById("RequestNo").value;
				const patchfeatures = document.getElementById("Features").value;
				const patchplatform = document.getElementById("patchplatform").value;
				const patchno = document.getElementById("patchno").value;
				await window.contract.methods.setPatch(fileData, patchname, patchplatform, patchfeatures, patchno,document.getElementById("RequestNo").value).send({ from: account }).then((result) => {
					const transactionsuccess = document.getElementById('TransactionSuccessfull');
					const div = document.createElement('div')
					div.classList.add("alert", "alert-primary");
					div.role = "alert";

					div.innerHTML = "Transaction Successfull with Transaction ID - " + `${result.transactionHash}`
					transactionsuccess.appendChild(div)
					setTimeout(function () {

						window.location.reload();
					}, 3000);
				});
			}
		}

	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
		crossorigin="anonymous"></script>
</body>

</html>