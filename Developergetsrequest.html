<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js"
		integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous"></script>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
	<script src="bothdevcommon.js"></script>
</head>

<body onload="connectMetamask()">
	<nav class="navbar navbar-expand-lg bg-dark">
		<div class="container-fluid">
			<div class="navbar-brand text-white" href="#">PMS</div>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
				aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="d-flex justify-content-end">
				<div class="collapse navbar-collapse" id="navbarNavDropdown">
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('EndUserReportBugs.html')">End User</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('LabellertoDev.html')">Labeller</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('Adminfromlabeller.html')">Admin</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark"
							onclick="window.open('Patchcreationdeveloper.html')">Developer</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('verifier.html')">Verifier</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('Aboutus.html')">ABOUT US</button>
					</div>
					<!-- <div class="nav-item">
                          <button class="btn btn-dark" onclick="window.open('Register.html')">Register</button>
                        </div> -->
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('page1.html')">
							LOG-IN
						</button>
					</div>
					<div class="nav-item">
						<button class="btn btn-dark" onclick="window.open('contact.html')">
							CONTACT US
						</button>
					</div>
				</div>
			</div>
		</div>
		</div>
	</nav>

	<br><br><br><br>
	<div class="container">
		<div class="card text-center">
			<div class="card-header ">
				<ul class="nav nav-pills card-header-pills d-flex justify-content-evenly">
					<li class="nav-item mx-2 col-sm">
						<button class="btn btn-dark" onclick="window.open('Developergetsrequest.html')">Gets Request
							from Admin
						</button>
					</li>
					<li class="nav-item mx-2 col-sm">
						<button class="btn btn-dark" onclick="window.open('Patchcreationdeveloper.html')">Register a

							Patch</button>
					</li>
					<li class="nav-item mx-2 col-sm">
						<button class="btn btn-dark" onclick="window.open('Developergetsrejectedpatches.html')">Rejected 

							Patches</button>
					</li>

				</ul>
			</div>

			<div class="card-body" id="cards">

			</div>
		</div>
	</div>
	<script src="verifierjs.js"></script>
	<script>
		let account;
		const connectMetamask = async () => {
			if (window.ethereum !== "undefined"){
				const accounts = await ethereum.request({ method: "eth_requestAccounts" });
				account = accounts[0];
			}
			const ABI2 = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_patchname",
				"type": "string"
			}
		],
		"name": "Deployed",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "PatchArray",
		"outputs": [
			{
				"internalType": "string",
				"name": "patchname",
				"type": "string"
			},
			{
				"internalType": "bytes",
				"name": "fileData",
				"type": "bytes"
			},
			{
				"internalType": "string",
				"name": "patchplatform",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "patchfeatures",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "time",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "verificationstatus",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "deploymentstatus",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "patchno",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "requestnumber",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "deployedTimeStamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "check",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "developer",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_patchname",
				"type": "string"
			}
		],
		"name": "findandreply",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_patchname",
				"type": "string"
			}
		],
		"name": "findandreplynotverified",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getdetails",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "patchname",
						"type": "string"
					},
					{
						"internalType": "bytes",
						"name": "fileData",
						"type": "bytes"
					},
					{
						"internalType": "string",
						"name": "patchplatform",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "patchfeatures",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "time",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "verificationstatus",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "deploymentstatus",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "patchno",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "requestnumber",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "deployedTimeStamp",
						"type": "uint256"
					}
				],
				"internalType": "struct RegisterPatch.Patch[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getdetailsRequest",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string[]",
						"name": "bugs",
						"type": "string[]"
					},
					{
						"internalType": "string[]",
						"name": "features",
						"type": "string[]"
					},
					{
						"internalType": "string",
						"name": "date",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "requestno",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "software",
						"type": "string"
					}
				],
				"internalType": "struct RegisterPatch.request[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "labeller",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "map",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"name": "map2",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "patches",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "requestArray",
		"outputs": [
			{
				"internalType": "string",
				"name": "date",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "requestno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "software",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "result",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "_filedata",
				"type": "bytes"
			},
			{
				"internalType": "string",
				"name": "_patchname",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_patchplatform",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_patchfeatures",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_patchno",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_requestnumber",
				"type": "uint256"
			}
		],
		"name": "setPatch",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string[]",
				"name": "_bugs",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "_features",
				"type": "string[]"
			},
			{
				"internalType": "string",
				"name": "_date",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_requestno",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_software",
				"type": "string"
			}
		],
		"name": "setRequest",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "verifier",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
				const Address2 = "0x58d9825e8Cb33e78989FD76663A5774fB280bF4c";
			window.web3 = await new Web3(window.ethereum);
			window.contract = await new window.web3.eth.Contract(ABI2, Address2);
			recievedata();
		}
		const recievedata = async () => {
			let requestnoarr = [];
			window.contract.methods.getdetails().call().then((res) => {
				console.log(res)
				for (let i = 0; i < res.length; i++) {
					requestnoarr.push(res[i].requestnumber)
				}
			});
			console.log(requestnoarr)
			window.contract.methods.getdetailsRequest().call().then((result) => {
				console.log(result);
				const cell = document.getElementById("cards");
				for (let i = result.length - 1; i >= 0; i--){
					if (!requestnoarr.includes(result[i].requestno)){
						const card = document.createElement("div");
						card.classList.add("card", "d-flex", "justify-content-start");
						const header = document.createElement("h5");
						header.classList.add("card-header", "d-flex", "justify-content-start");
						header.innerHTML = "RequestNo" + result[i].requestno;
						header.classList.add("bg-dark", "text-white");
						const div2 = document.createElement("div");
						const body = document.createElement("h5");
						body.classList.add("card-body", "d-flex", "justify-content-start");
						body.innerHTML = "Bugs:";
						for (let j = 0; j < result[i].bugs.length; j++) {
							if (j == 0) {
								body.innerHTML += result[i].bugs[j];
							}
							else {
								body.innerHTML += "," + result[i].bugs[j];
							}
						}
						const body2 = document.createElement("h5");
						body2.classList.add("card-body", "d-flex", "justify-content-start");
						body2.innerHTML = "Features:";
						for (let j = 0; j < result[i].features.length; j++) {
							if (j == 0) {
								body2.innerHTML += result[i].features[j];
							}
							else {
								body2.innerHTML += "," + result[i].features[j];
							}
						}
						const Date = document.createElement("h5");
						Date.innerHTML = " Target Date:" + result[i].date;
						Date.classList.add("card-body", "d-flex", "justify-content-start")

						const div3 = document.createElement("div");
						div3.classList.add("d-flex", "justify-content-end");
						const btnstart = document.createElement("button");
						btnstart.classList.add("btn", "btn-dark", "me-5", "my-4");
						btnstart.innerHTML = "UPLOAD";
						// console.log(result[i].bugs);
						// console.log(result[i].features);
						btnstart.addEventListener("click", function () {
							const myObj = {
								software: result[i].software,
								requestnumber: result[i][3],
								arrbugs: result[i].bugs,
								arrfeatures: result[i].features
							};
							var myObjStr = JSON.stringify(myObj);
							localStorage.setItem('myFlag', 'GeneralPage');
							localStorage.setItem("myObj", myObjStr);
							window.open("Patchcreationdeveloper.html");
						})
						div3.appendChild(btnstart)
						card.appendChild(header);
						header.appendChild(div2);
						card.appendChild(body);
						card.appendChild(body2);
						card.appendChild(Date);
						card.appendChild(div3)
						cell.appendChild(card);
						cell.appendChild(document.createElement("br"));
					}
				}
			});

		}


	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
		crossorigin="anonymous"></script>
</body>

</html>